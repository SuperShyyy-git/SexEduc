{% extends 'base.html' %}
{% load youtube_tags %}

{% block title %}Video URL Diagnostic{% endblock %}

{% block content %}
<div class="container" style="padding: 2rem; background: white; margin-top: 2rem; border-radius: 1rem;">
    <h1>Video URL Diagnostic Tool</h1>
    
    <div style="margin-top: 2rem;">
        <h2>All Lessons with Video URLs</h2>
        
        {% for lesson in lessons %}
        <div style="border: 2px solid #e0e0e0; padding: 1.5rem; margin-bottom: 1.5rem; border-radius: 0.5rem;">
            <h3>{{ lesson.course.title }} - {{ lesson.title }}</h3>
            
            <table style="width: 100%; margin-top: 1rem;">
                <tr>
                    <td style="width: 200px; font-weight: bold;">Original URL:</td>
                    <td style="word-break: break-all; font-family: monospace; background: #f5f5f5; padding: 0.5rem;">
                        {{ lesson.video_url }}
                    </td>
                </tr>
                <tr>
                    <td style="font-weight: bold; padding-top: 0.5rem;">Converted Embed URL:</td>
                    <td style="word-break: break-all; font-family: monospace; background: #f5f5f5; padding: 0.5rem;">
                        {{ lesson.video_url|youtube_embed }}
                    </td>
                </tr>
                <tr>
                    <td style="font-weight: bold; padding-top: 0.5rem;">Lesson Link:</td>
                    <td style="padding-top: 0.5rem;">
                        <a href="{% url 'courses:lesson' lesson.course.id lesson.id %}" target="_blank" class="btn btn-primary">View Lesson</a>
                    </td>
                </tr>
            </table>
            
            <div style="margin-top: 1rem;">
                <h4>Test Embed:</h4>
                <div style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden; background: #000; border-radius: 0.5rem;">
                    <iframe 
                        src="{{ lesson.video_url|youtube_embed }}" 
                        frameborder="0" 
                        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" 
                        allowfullscreen
                        style="position: absolute; top: 0; left: 0; width: 100%; height: 100%;"
                    ></iframe>
                </div>
            </div>
        </div>
        {% empty %}
        <p style="color: #6c757d;">No lessons with video URLs found.</p>
        <p>To add videos:</p>
        <ol>
            <li>Go to <a href="/admin/">Admin Panel</a></li>
            <li>Navigate to Courses â†’ Lessons</li>
            <li>Edit a lesson and add a YouTube URL</li>
        </ol>
        {% endfor %}
    </div>
</div>

<style>
    table {
        border-collapse: collapse;
    }
    
    table td {
        padding: 0.5rem;
    }
    
    .btn {
        display: inline-block;
        padding: 0.5rem 1rem;
        background: #667eea;
        color: white;
        text-decoration: none;
        border-radius: 0.25rem;
    }
    
    .btn:hover {
        background: #5568d3;
    }
</style>
{% endblock %}
